# Go VDOM v1.2.0 æ›´æ–°æ‘˜è¦

## ğŸ‰ é‡å¤§æ›´æ–°

v1.2.0 ç‰ˆæœ¬å¸¶ä¾†ä¸‰å€‹é‡å¤§å„ªåŒ–ï¼Œé¡¯è‘—æå‡äº† Go VDOM çš„éˆæ´»æ€§å’Œæ€§èƒ½ã€‚

---

## 1ï¸âƒ£ Try-Catch-Finally é‡æ–°è¨­è¨ˆ

### æ ¸å¿ƒè®Šæ›´

**Try ä¸å†è‡ªå‹•åŒ…è£åœ¨ IIFE ä¸­**ï¼Œç”Ÿæˆç´”ç²¹çš„ `try-catch-finally` èªå¥ã€‚

### è¨­è¨ˆç†å¿µ

- **è·è²¬åˆ†é›¢**ï¼šTry åªè² è²¬éŒ¯èª¤è™•ç†
- **éˆæ´»æ€§å„ªå…ˆ**ï¼šç”¨æˆ¶æ±ºå®šä½•æ™‚éœ€è¦ async/await
- **å¯çµ„åˆæ€§**ï¼šTry å¯ä»¥åœ¨ä»»ä½•ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨

### æ–° API

```go
// åŒæ­¥ try-catch
js.Fn(nil,
    js.Try(
        js.Const("x", "Math.random()"),
    ).Catch(
        js.Alert("error.message"),
    ).End(),
)

// ç•°æ­¥ try-catchï¼ˆåœ¨ AsyncFn ä¸­ï¼‰
js.AsyncFn(nil,
    js.Try(
        js.Const("data", "await fetch('/api')"),
    ).Catch(
        js.Log("error.message"),
    ).End(),
)

// ç«‹å³åŸ·è¡Œç•°æ­¥å‡½æ•¸
js.AsyncDo(
    js.Try(
        js.Const("data", "await fetch('/api')"),
    ).Catch(
        js.Log("error.message"),
    ).End(),
)
```

### æ–°å¢ Do / AsyncDo

å°ˆé–€ç”¨æ–¼å‰µå»ºç«‹å³åŸ·è¡Œå‡½æ•¸ï¼ˆIIFEï¼‰ï¼š

```go
// Do - æ™®é€š IIFE
js.Do(
    js.Const("x", "1"),
    js.Log("x"),
)
// ç”Ÿæˆï¼š(()=>{const x=1;console.log(x)})()

// AsyncDo - ç•°æ­¥ IIFE
js.AsyncDo(
    js.Const("data", "await fetch('/api')"),
    js.Log("data"),
)
// ç”Ÿæˆï¼š(async()=>{const data=await fetch('/api');console.log(data)})()
```

### å„ªå‹¢

- âœ… **æ›´éˆæ´»**ï¼šTry å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨
- âœ… **è·è²¬æ¸…æ™°**ï¼šTry ç®¡éŒ¯èª¤ï¼ŒDo/AsyncDo ç®¡ IIFE
- âœ… **æ˜ç¢ºæ€§**ï¼šæ²’æœ‰éš±è—çš„å‡½æ•¸åŒ…è£
- âœ… **å¯çµ„åˆ**ï¼šå„éƒ¨åˆ†å¯ä»¥è‡ªç”±çµ„åˆ

### æ–‡æª”

- [å®Œæ•´æŒ‡å—](TRY_CATCH_FINALLY.md)
- [å¿«é€Ÿåƒè€ƒ](TRY_CATCH_QUICK_REF.md)
- [è¨­è¨ˆç†å¿µ](DESIGN_RATIONALE.md)

---

## 2ï¸âƒ£ JavaScript ä»£ç¢¼æœ€å°åŒ–

### ç‰¹æ€§

æ‰€æœ‰ç”Ÿæˆçš„ JavaScript ä»£ç¢¼**è‡ªå‹•æœ€å°åŒ–**ï¼š

- å»é™¤æ›è¡Œå’Œç¸®æ’
- ç§»é™¤å¤šé¤˜ç©ºæ ¼
- æ¸›å°‘ 30-50% é«”ç©

### ç¤ºä¾‹

```go
// Go ä»£ç¢¼
js.AsyncFn(nil,
    js.Const("x", "1"),
    js.Const("y", "2"),
    js.Log("x+y"),
)

// ç”Ÿæˆï¼ˆæœ€å°åŒ–ï¼‰
async()=>{const x=1;const y=2;console.log(x+y)}

// å°æ¯”ï¼ˆæœªæœ€å°åŒ–ï¼Œç´„ 70 å­—ç¯€ï¼‰
async () => {
  const x = 1;
  const y = 2;
  console.log(x+y);
}
```

### è¦†è“‹ç¯„åœ

æ‰€æœ‰ JavaScript ç”Ÿæˆå‡½æ•¸éƒ½ç¶“éæœ€å°åŒ–ï¼š

- `Fn` / `AsyncFn`
- `Try` / `Catch` / `Finally`
- `Do` / `AsyncDo`
- `ForEachJS` / `ForEachWithIndexJS`

### æ€§èƒ½æå‡

| é …ç›® | æœªæœ€å°åŒ– | æœ€å°åŒ– | ç¯€çœ |
|------|---------|--------|------|
| ä¸­ç­‰é é¢ (100 è¡Œ JS) | ~1850 å­—ç¯€ | ~1180 å­—ç¯€ | **36%** |
| + gzip å£“ç¸® | ~600 å­—ç¯€ | ~400 å­—ç¯€ | **33%** |

### å„ªå‹¢

- âœ… **æ¸›å°‘å‚³è¼¸å¤§å°**ï¼šå¹³å‡æ¸›å°‘ 30-50%
- âœ… **åŠ å¿«è¼‰å…¥é€Ÿåº¦**ï¼šæ›´å°‘çš„æ•¸æ“šå‚³è¼¸
- âœ… **é›¶é…ç½®**ï¼šè‡ªå‹•æ‡‰ç”¨ï¼Œç„¡éœ€è¨­ç½®
- âœ… **ä¸å½±éŸ¿åŠŸèƒ½**ï¼šåªç§»é™¤ç©ºç™½

### æ–‡æª”

- [å„ªåŒ–æŒ‡å—](OPTIMIZATION.md)

---

## 3ï¸âƒ£ Const/Let æ”¯æŒ JSAction

### è®Šæ›´

å‡½æ•¸ç°½åå¾ `(string, string)` æ”¹ç‚º `(string, any)`ï¼š

```go
// èˆŠç°½å
func Const(varName string, value string) JSAction

// æ–°ç°½å
func Const(varName string, value any) JSAction
func Let(varName string, value any) JSAction
```

### æ”¯æŒé¡å‹

- `string` - ç›´æ¥ä½¿ç”¨
- `JSAction` - æå– Code
- å…¶ä»–é¡å‹ - è½‰ç‚ºå­—ç¬¦ä¸²

### ä½¿ç”¨ç¤ºä¾‹

```go
// å‚³å…¥å­—ç¬¦ä¸²ï¼ˆå‘å¾Œå…¼å®¹ï¼‰
js.Const("x", "1")
// ç”Ÿæˆï¼šconst x=1

// å‚³å…¥ JSActionï¼ˆæ–°åŠŸèƒ½ï¼‰
js.Const("random", js.Call("Math.random"))
// ç”Ÿæˆï¼šconst random=Math.random()

js.Const("doubled", JSAction{Code: "x * 2"})
// ç”Ÿæˆï¼šconst doubled=x * 2

js.Const("data", js.Ident("response.data"))
// ç”Ÿæˆï¼šconst data=response.data
```

### å¯¦éš›æ‡‰ç”¨

```go
js.AsyncFn(nil,
    // ç²å–éŸ¿æ‡‰
    js.Const("response", "await fetch('/api/users')"),
    
    // è§£æ JSONï¼ˆä½¿ç”¨ JSActionï¼‰
    js.Const("users", JSAction{Code: "await response.json()"}),
    
    // ç²å–ç¬¬ä¸€å€‹ç”¨æˆ¶
    js.Const("firstUser", JSAction{Code: "users[0]"}),
    
    // è¨ˆç®—ç¸½æ•¸
    js.Const("total", js.Call("users.length")),
    
    // é¡¯ç¤ºä¿¡æ¯
    js.Alert("'ç¸½å…± '+total+' å€‹ç”¨æˆ¶'"),
)
```

### å„ªå‹¢

- âœ… **æ›´éˆæ´»**ï¼šå¯ä»¥å‚³å…¥ä»»ä½•é¡å‹
- âœ… **æ›´å¥½çš„çµ„åˆ**ï¼šJSAction å¯ä»¥çµ„åˆä½¿ç”¨
- âœ… **æ¸›å°‘å­—ç¬¦ä¸²æ“ä½œ**ï¼šä¸éœ€è¦æ‰‹å‹•æ‹¼æ¥
- âœ… **å‘å¾Œå…¼å®¹**ï¼šèˆŠä»£ç¢¼ä»ç„¶æœ‰æ•ˆ

### æ–‡æª”

- [å„ªåŒ–æŒ‡å—](OPTIMIZATION.md)

---

## ğŸ“¦ æ–°å¢ç¤ºä¾‹

### `examples/07_trycatch_usage.go`

å±•ç¤ºæ‰€æœ‰ Try-Catch-Finally å’Œ Do/AsyncDo ç”¨æ³•ï¼š

- åŒæ­¥ try-catch
- AsyncFn ä¸­çš„ try-catch
- AsyncDo ç«‹å³åŸ·è¡Œ
- Do å‰µå»ºç¨ç«‹ä½œç”¨åŸŸ
- å®Œæ•´çš„ API è«‹æ±‚ç¤ºä¾‹

é‹è¡Œï¼š
```bash
go run examples/07_trycatch_usage.go
# è¨ªå• http://localhost:8086
```

### `examples/08_minified_js.go`

å±•ç¤ºæœ€å°åŒ–æ•ˆæœå’Œ JSAction æ”¯æŒï¼š

- æœ€å°åŒ–å‰å¾Œå°æ¯”
- å¯¦éš›å¤§å°ç¯€çœ
- JSAction åœ¨ Const/Let ä¸­çš„ä½¿ç”¨
- å¯¦æ™‚æ¸¬è©¦å’Œæ¼”ç¤º

é‹è¡Œï¼š
```bash
go run examples/08_minified_js.go
# è¨ªå• http://localhost:8087
```

---

## ğŸ“š æ–°å¢æ–‡æª”

| æ–‡æª” | èªªæ˜ |
|------|------|
| `TRY_CATCH_FINALLY.md` | Try-Catch-Finally å®Œæ•´ä½¿ç”¨æŒ‡å— |
| `TRY_CATCH_QUICK_REF.md` | Try-Catch-Finally å¿«é€Ÿåƒè€ƒ |
| `CHANGES_TRY_CATCH.md` | Try-Catch-Finally API é‡æ–°è¨­è¨ˆèªªæ˜ |
| `DESIGN_RATIONALE.md` | è¨­è¨ˆç†å¿µå’Œæ±ºç­–èªªæ˜ |
| `OPTIMIZATION.md` | ä»£ç¢¼å„ªåŒ–å’Œæ€§èƒ½æå‡æŒ‡å— |

---

## ğŸ”„ é·ç§»æŒ‡å—

### Try-Catch-Finally

```go
// èˆŠï¼šTry è‡ªå‹•åŒ…è£ï¼ˆv1.1.0 åŠæ›´æ—©ç‰ˆæœ¬ï¼‰
Button(Props{
    "onClick": js.Try(
        js.Const("data", "await fetch('/api')"),
    ).Catch(...).End(),
})

// æ–°ï¼šæ˜ç¢ºä½¿ç”¨ AsyncFn åŒ…è£
Button(Props{
    "onClick": js.AsyncFn(nil,
        js.Try(
            js.Const("data", "await fetch('/api')"),
        ).Catch(...).End(),
    ),
})
```

### Const/Let

ç„¡éœ€é·ç§»ï¼èˆŠä»£ç¢¼ä»ç„¶æœ‰æ•ˆï¼š

```go
// èˆŠæ–¹å¼ä»ç„¶æ”¯æŒ
js.Const("x", "1")

// æ–°æ–¹å¼æä¾›æ›´å¤šé¸æ“‡
js.Const("y", js.Call("Math.random"))
```

### ä»£ç¢¼æœ€å°åŒ–

è‡ªå‹•æ‡‰ç”¨ï¼Œç„¡éœ€ä»»ä½•æ›´æ”¹ï¼

---

## ğŸ¯ å‘å¾Œå…¼å®¹æ€§

æ‰€æœ‰è®Šæ›´éƒ½ä¿æŒå‘å¾Œå…¼å®¹ï¼š

- âœ… èˆŠçš„ `TryCatch` å‡½æ•¸ä»å¯ç”¨
- âœ… `Const`/`Let` ä»æ”¯æŒå­—ç¬¦ä¸²åƒæ•¸
- âœ… ä»£ç¢¼æœ€å°åŒ–è‡ªå‹•æ‡‰ç”¨ï¼Œä¸ç ´å£ç¾æœ‰ä»£ç¢¼

---

## ğŸ“Š ç¸½é«”æå‡

| æŒ‡æ¨™ | æ”¹å–„ |
|------|------|
| ä»£ç¢¼éˆæ´»æ€§ | â¬†ï¸ é¡¯è‘—æå‡ |
| ä»£ç¢¼é«”ç© | â¬‡ï¸ æ¸›å°‘ 30-50% |
| è·è²¬æ¸…æ™°åº¦ | â¬†ï¸ å¤§å¹…æ”¹å–„ |
| API ä¸€è‡´æ€§ | â¬†ï¸ æ›´åŠ çµ±ä¸€ |
| é–‹ç™¼é«”é©— | â¬†ï¸ æ›´åŠ å‹å¥½ |

---

## ğŸš€ é–‹å§‹ä½¿ç”¨

```bash
# æ›´æ–°åˆ° v1.2.0
go get -u github.com/TimLai666/go-vdom@latest

# é‹è¡Œç¤ºä¾‹
go run examples/07_trycatch_usage.go
go run examples/08_minified_js.go
```

---

## ğŸ’¡ è¨­è¨ˆå“²å­¸

v1.2.0 çš„æ ¸å¿ƒè¨­è¨ˆå“²å­¸ï¼š

1. **çµ¦ç”¨æˆ¶å®Œå…¨çš„æ§åˆ¶æ¬Š**ï¼šä¸åšéš±å¼çš„ã€Œè°æ˜ã€æ±ºå®š
2. **è·è²¬åˆ†é›¢**ï¼šæ¯å€‹å·¥å…·åªåšä¸€ä»¶äº‹ï¼Œåšå¥½ä¸€ä»¶äº‹
3. **æ˜ç¢ºå„ªæ–¼éš±å¼**ï¼šä»£ç¢¼æ„åœ–æ¸…æ™°å¯è¦‹
4. **å„ªåŒ–ä½†ä¸çŠ§ç‰²éˆæ´»æ€§**ï¼šè‡ªå‹•æœ€å°åŒ–ä½†ä¿æŒ API ç°¡æ½”

---

## ğŸ“ åé¥‹èˆ‡æ”¯æŒ

- æ–‡æª”ï¼š`docs/` ç›®éŒ„
- ç¤ºä¾‹ï¼š`examples/` ç›®éŒ„
- Issuesï¼šGitHub Issues

æ„Ÿè¬ä½¿ç”¨ Go VDOMï¼ğŸ‰